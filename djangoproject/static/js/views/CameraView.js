// Generated by CoffeeScript 1.4.0

window.WiserWater.CameraView = Backbone.View.extend({
  initialize: function(options) {
    this.template = _.template(WiserWater.tpl.get('camera'));
    return this;
  },
  events: {
    "click #instructionOK": "onInstructionClickOK"
  },
  render: function() {
    $(this.el).html(this.template({
      title: "Take a photo of your water"
    }));
    return this;
  },
  snapPhoto: function() {
    var canvas, context, errBack, hide, show, video, videoObj;
    canvas = document.getElementById("canvas");
    context = canvas.getContext("2d");
    video = document.getElementById("video");
    videoObj = {
      video: true
    };
    errBack = function(error) {
      return console.log("Video capture error: ", error.code);
    };
    if (navigator.getUserMedia) {
      navigator.getUserMedia(videoObj, (function(stream) {
        video.src = stream;
        return video.play();
      }), errBack);
    } else if (navigator.webkitGetUserMedia) {
      navigator.webkitGetUserMedia(videoObj, (function(stream) {
        video.src = window.webkitURL.createObjectURL(stream);
        return video.play();
      }), errBack);
    }
    show = function() {
      $('#camera').hide();
      $('#loadingContainer').show();
      return setTimeout(hide, 3000);
    };
    hide = function() {
      $('#loadingContainer').hide();
      console.debug("rendering feedback??");
      return WiserWater.app.renderFeedback();
    };
    return document.getElementById("snap").addEventListener("click", function() {
      context.drawImage(video, 0, 0, 640, 480);
      console.debug("setting timeout");
      show();
      return console.debug("showed loading");
    });
  },
  onInstructionClickOK: function() {
    $('#photoInstructions').hide();
    $('#camera').show();
    return this.snapPhoto();
  }
});
